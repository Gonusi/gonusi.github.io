<html>
	<head>
		<link href="/css/main.css" rel="stylesheet" />
		<link href="/css/prism-theme-retro.css" rel="stylesheet" />
		<title>Learning to (kind of) enjoy test driven development in JS with simpler tests Â· TODO</title>
		<meta name="description" content="TDD encorces good practices - including actually making your components easily testable without duplicating their functionality in test code and and, having broken tests after minor(est)  reworks."/>
	</head>
	<body>
		<header class="header">
			<div class="blogInfo">
				<div class="logo">Kasparas Anusauskas</div>
				<div class="about">Personal development notes and experiments</div>
			</div>
			<nav class="nav">
				<ul class="navList">
					<li>
						<a href="/"> Home </a>
					</li>
					<li>
						<a href="/about">About</a>
					</li>
				</ul>
			</nav>
		</header>
		<main class="wrapper">
			<h1>Learning to (kind of) enjoy test driven development in JS with simpler tests</h1>
			<h2></h2>
<p>I have never <em>really</em> used test driven development. When I tried, it got too clumsy, messy, I tried testing methods of my classes. Didn't really know what I was doing.</p>
<p>The light came after attempting to TDD a functional component wish useState / useEffect hooks when they were released. No longer could I access state or internal methods of a class in my tests. Not without keeping them outside the component I then knew this is not how it was intended to be done.</p>
<p>Along came the (https://testing-library.com/)[https://testing-library.com/] with it's guildelines about how one should test components exactly the way a user would use them.</p>
<p>This means always rendering them to a virtual DOM, accessing elements by their DOM attributes, manipulating them and asserting based on DOM state. You just have no way to do more anymore. And that is pretty liberating in a sense that you can just focus on writing a decent test for the real use case.</p>
<p>An additonal benefit is the encouragment to drop the long standing &quot;1 assert per 1 test&quot; rule (it's in the FAQ). The tooling is capable to show you exactly on which line the test fails while also outputing color coded &quot;Expected vs Reality&quot; DOM state. So it's just no longer useful to go through the trouble of writing more tests. Test a success case, test a failure case and that might just do it.</p>
<h2>The old and the new ways</h2>
<p><strong>If there is a component involving:</strong></p>
<ol>
<li>Show &quot;Loading...&quot; text</li>
<li>Fetch data A from endpoint a</li>
<li>Fetch data B from endpoint b</li>
<li>Process A using some Array.reduce + Array.filter etc.</li>
<li>Process B using some Array.reduce + Array.filter etc.</li>
<li>Merge processed data using some procedure only used in that component</li>
<li>Display (correctly) merged data in a list</li>
</ol>
<p><strong>How I used to test it</strong></p>
<p>I write 7 or more tests for each step. If this was a functional component, I would moved the algorithms in 4, 5, 6 outside the component and test them separately.</p>
<p>This isn't ideal, because this is a component, not some helper library. If requirements change, algoriths processing the data will change. 4, 5, 6, 7 will all get broken. Or, what if we use new library which performs exactly what 4, 5 used to do. We can't refactor 4 and 5 out without breaking the tests.</p>
<p>However, as I mentioned, this is a component. All we care about is what the user sees is correct, as defined by the task, right?</p>
<p><strong>How I'm learning to do it now</strong></p>
<p>I write one longer test. In that test I check 1 and 7. Possibly, I also check if 2, 3 calls API only once, because are quite suitable for nasty bugs involving render loops.</p>
<h2>Does this break TDD if I don't test each step?</h2>
<p>Initially, I thought of it that way. How do I &quot;write a small test and make it pass&quot; If I don't write a test. I mean, we all know the mantra:</p>
<ol>
<li>Split task into smallest logical parts</li>
<li>Write a test for that small part</li>
<li>Make it pass</li>
<li>Repeat</li>
</ol>
<p>Then refactor to make it nice, make it fast. So how do I write the logic without testing it? Well, the key point for me was noticing that mostly, just as I said, the 'logic' is just a few 'reduce' + 'filter' statements. Perfectly acceptable to write using just one test checking the final result.</p>
<p>To tell you the truth, I didn't yet TDD a really big component (this is typically a large form with one input affecting value of others after calling API first). However I feel now I'll just be forced to split it further. And, if there's a lot of conditional logic, it's still always possible to move it to functions outside the component and test them separately.</p>
<p>Any way, it's the first time I'm actually looking forward to it.</p>
<h2>Excercise</h2>
<p>Here's the test:</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// Task:</span><br><span class="token comment">// show "Loading..." text</span><br><span class="token comment">// fetch data [b, a, a, a] from endpoint /lowercase</span><br><span class="token comment">// fetch data [A, B, C, B, E] from endpoint /uppercase</span><br><span class="token comment">//</span><br><span class="token comment">// Join similar characters from both endpoints, display their counts sorted like this:</span><br><span class="token comment">// - a: 4</span><br><span class="token comment">// - b: 3</span><br><span class="token comment">// - c</span><br><span class="token comment">// - e: 1</span><br><span class="token comment">//</span><br><span class="token comment">// // hide "Loading..." text</span><br><span class="token comment">// In case of unexpected error from any endpoint, show error message "Unexpected error".</span><br><br><span class="token comment">// Wrote the tests based on the excellent example of testing-library:</span><br><span class="token comment">// https://testing-library.com/docs/react-testing-library/example-intro</span><br><br><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> rest <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"msw"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> setupServer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"msw/node"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> fireEvent<span class="token punctuation">,</span> waitFor<span class="token punctuation">,</span> screen <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@testing-library/react"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">"@testing-library/jest-dom/extend-expect"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> Component <span class="token keyword">from</span> <span class="token string">"./_component.jsx"</span><span class="token punctuation">;</span><br><br><span class="token keyword">let</span> lowercaseCallCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> upperCaseCallCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">setupServer</span><span class="token punctuation">(</span><br>	rest<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/lowercase"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>		lowercaseCallCount<span class="token operator">++</span><span class="token punctuation">;</span><br>		<span class="token keyword">return</span> <span class="token function">res</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>	rest<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/uppercase"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>		upperCaseCallCount<span class="token operator">++</span><span class="token punctuation">;</span><br>		<span class="token keyword">return</span> <span class="token function">res</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"A"</span><span class="token punctuation">,</span> <span class="token string">"D"</span><span class="token punctuation">,</span> <span class="token string">"C"</span><span class="token punctuation">,</span> <span class="token string">"F"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> server<span class="token punctuation">.</span><span class="token function">resetHandlers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">afterAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> server<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"fetches lowercase and uppercase character arrays, renders total character counts"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	<span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Component lowercaseUrl<span class="token operator">=</span><span class="token string">"/lowercase"</span> uppercaseUrl<span class="token operator">=</span><span class="token string">"/uppercase"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">expect</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">"Loading..."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">let</span> options<span class="token punctuation">;</span><br>	<span class="token keyword">await</span> <span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>		options <span class="token operator">=</span> screen<span class="token punctuation">.</span><span class="token function">getAllByTestId</span><span class="token punctuation">(</span><span class="token string">"char-select-option"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>		<span class="token keyword">return</span> options<span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">expect</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">expect</span><span class="token punctuation">(</span>options<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveTextContent</span><span class="token punctuation">(</span><span class="token string">"Select char"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">expect</span><span class="token punctuation">(</span>options<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>selected<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">expect</span><span class="token punctuation">(</span>options<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveTextContent</span><span class="token punctuation">(</span><span class="token string">"a: 3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">expect</span><span class="token punctuation">(</span>options<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveTextContent</span><span class="token punctuation">(</span><span class="token string">"b: 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">expect</span><span class="token punctuation">(</span>options<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveTextContent</span><span class="token punctuation">(</span><span class="token string">"c: 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">expect</span><span class="token punctuation">(</span>options<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveTextContent</span><span class="token punctuation">(</span><span class="token string">"d: 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">expect</span><span class="token punctuation">(</span>options<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveTextContent</span><span class="token punctuation">(</span><span class="token string">"f: 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token function">expect</span><span class="token punctuation">(</span>options<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveValue</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">expect</span><span class="token punctuation">(</span>options<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveValue</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">expect</span><span class="token punctuation">(</span>options<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveValue</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">expect</span><span class="token punctuation">(</span>options<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveValue</span><span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">expect</span><span class="token punctuation">(</span>options<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveValue</span><span class="token punctuation">(</span><span class="token string">"d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">expect</span><span class="token punctuation">(</span>options<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveValue</span><span class="token punctuation">(</span><span class="token string">"f"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	fireEvent<span class="token punctuation">.</span><span class="token function">change</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByTestId</span><span class="token punctuation">(</span><span class="token string">"select"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> target<span class="token operator">:</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token string">"b"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">expect</span><span class="token punctuation">(</span>options<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>selected<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeFalsy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">expect</span><span class="token punctuation">(</span>options<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>selected<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token function">expect</span><span class="token punctuation">(</span>lowercaseCallCount<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">expect</span><span class="token punctuation">(</span>upperCaseCallCount<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">expect</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">queryByText</span><span class="token punctuation">(</span><span class="token string">"Loading..."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">expect</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">"Next"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"renders error message if unexpected fetch error occurs"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><br>		rest<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/lowercase"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>			<span class="token keyword">return</span> <span class="token function">res</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>		<span class="token punctuation">}</span><span class="token punctuation">)</span><br>	<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Component lowercaseUrl<span class="token operator">=</span><span class="token string">"/lowercase"</span> uppercaseUrl<span class="token operator">=</span><span class="token string">"/uppercase"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">expect</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">"Loading..."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">await</span> <span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> screen<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">"Unexpected error"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">expect</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">queryByText</span><span class="token punctuation">(</span><span class="token string">"Loading..."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>And here's the function:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useReducer<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">"axios"</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span><br>	charCounts<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>	error<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>	isLoading<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">charSelectReducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	<span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>		<span class="token keyword">case</span> <span class="token string">"SUCCESS"</span><span class="token operator">:</span><br>			<span class="token keyword">return</span> <span class="token punctuation">{</span><br>				charCounts<span class="token operator">:</span> action<span class="token punctuation">.</span>charCounts<span class="token punctuation">,</span><br>				error<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>				isLoading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>			<span class="token punctuation">}</span><span class="token punctuation">;</span><br>		<span class="token keyword">case</span> <span class="token string">"ERROR"</span><span class="token operator">:</span><br>			<span class="token keyword">return</span> <span class="token punctuation">{</span><br>				charCounts<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>				error<span class="token operator">:</span> action<span class="token punctuation">.</span>error<span class="token punctuation">,</span><br>				isLoading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>			<span class="token punctuation">}</span><span class="token punctuation">;</span><br>		<span class="token keyword">default</span><span class="token operator">:</span><br>			<span class="token keyword">return</span> state<span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">CharSelect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> lowercaseUrl<span class="token punctuation">,</span> uppercaseUrl <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	<span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> setValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> charCounts<span class="token punctuation">,</span> error<span class="token punctuation">,</span> isLoading <span class="token punctuation">}</span><span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span><br>		charSelectReducer<span class="token punctuation">,</span><br>		initialState<br>	<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>		<span class="token keyword">const</span> <span class="token punctuation">{</span> token<span class="token operator">:</span> cancelToken<span class="token punctuation">,</span> cancel <span class="token punctuation">}</span> <span class="token operator">=</span> axios<span class="token punctuation">.</span>CancelToken<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>		<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>			<span class="token keyword">try</span> <span class="token punctuation">{</span><br>				<span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> data<span class="token operator">:</span> lowercase <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> data<span class="token operator">:</span> uppercase <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><br>					axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>lowercaseUrl<span class="token punctuation">,</span> <span class="token punctuation">{</span> cancelToken <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>					axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>uppercaseUrl<span class="token punctuation">,</span> <span class="token punctuation">{</span> cancelToken <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>				<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>				<span class="token keyword">const</span> charCounts <span class="token operator">=</span> lowercase<br>					<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>uppercase<span class="token punctuation">)</span><br>					<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">></span> b<span class="token punctuation">)</span><br>					<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> char</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>						<span class="token keyword">const</span> lowChar <span class="token operator">=</span> char<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>						acc<span class="token punctuation">[</span>lowChar<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">++</span>acc<span class="token punctuation">[</span>lowChar<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">;</span><br>						<span class="token keyword">return</span> acc<span class="token punctuation">;</span><br>					<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>				<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">"SUCCESS"</span><span class="token punctuation">,</span> charCounts <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>			<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>				<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">"ERROR"</span><span class="token punctuation">,</span> error<span class="token operator">:</span> <span class="token string">"Unexpected error"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>			<span class="token punctuation">}</span><br>		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>			<span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>		<span class="token punctuation">}</span><span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>axios<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token keyword">if</span> <span class="token punctuation">(</span>isLoading<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">"Loading..."</span><span class="token punctuation">;</span><br>	<span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token keyword">return</span> error<span class="token punctuation">;</span><br>	<span class="token keyword">return</span> <span class="token punctuation">(</span><br>		<span class="token operator">&lt;</span><span class="token operator">></span><br>			<span class="token operator">&lt;</span>select data<span class="token operator">-</span>testid<span class="token operator">=</span><span class="token string">"select"</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setValue</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span> value<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token operator">></span><br>				<span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token string">""</span> data<span class="token operator">-</span>testid<span class="token operator">=</span><span class="token string">"char-select-option"</span><span class="token operator">></span><br>					Select char<br>				<span class="token operator">&lt;</span><span class="token operator">/</span>option<span class="token operator">></span><br>				<span class="token punctuation">{</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>charCounts<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">char</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><br>					<span class="token operator">&lt;</span>option key<span class="token operator">=</span><span class="token punctuation">{</span>char<span class="token punctuation">}</span> value<span class="token operator">=</span><span class="token punctuation">{</span>char<span class="token punctuation">}</span> data<span class="token operator">-</span>testid<span class="token operator">=</span><span class="token string">"char-select-option"</span><span class="token operator">></span><br>						<span class="token punctuation">{</span>char<span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span>charCounts<span class="token punctuation">[</span>char<span class="token punctuation">]</span><span class="token punctuation">}</span><br>					<span class="token operator">&lt;</span><span class="token operator">/</span>option<span class="token operator">></span><br>				<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><br>			<span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">></span><br>			<span class="token operator">&lt;</span>button<span class="token operator">></span>Next<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><br>		<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span><br>	<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> CharSelect<span class="token punctuation">;</span></code></pre>

		</main>
		<footer class="footer">
			<div class="about">
				<div><strong>Kasparas Anusauskas</strong></div>
				<a href="https://www.linkedin.com/in/kasparas-anusauskas">LinkedIn</a>
			</div>
		</footer>
	</body>
</html>
