<!DOCTYPE html>
<html lang="en">
	<head>
		<link href="/css/main.css" rel="stylesheet" />
		<link href="/css/prism-theme-retro.css" rel="stylesheet" />
		<title>Typescript - discriminated unions for more concise react component prop types Â· Kasparas Anusauskas</title>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description" content="If your react component can accept a prop (or not) based on the value of another prop, typescript can help to avoid mistakes by giving proper warnings on incorrect usage." />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link rel="icon" href="/assets/favicon.png" sizes="any" />
		<link rel="apple-touch-icon" href="/assets/favicon.png" />
		<link
			href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,400;0,700;0,900;1,400;1,700&family=Lora:ital,wght@0,400;0,500;1,400;1,500"
			rel="stylesheet"
		/>
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-115C9Z6LKN"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag() {
				dataLayer.push(arguments);
			}
			gtag("js", new Date());

			gtag("config", "G-115C9Z6LKN");
		</script>
	</head>
	<body>
		<div class="wrapper">
			<header class="header">
				<div class="blogInfo">
					<div class="logo">Kasparas Anusauskas</div>
					<div class="about">Personal development notes and experiments</div>
				</div>
				<nav class="nav">
					<ul class="navList">
						<li>
							<a href="/"> Home </a>
						</li>
						<li>
							<a href="/about">About</a>
						</li>
					</ul>
				</nav>
			</header>
			<main class="content">
				<h1>Typescript - discriminated unions for more concise react component prop types</h1>
				<div class="inner"><p>I had a problem where a component providing our app graphql capabilities was returning one of those:</p>
<ul>
<li><code>&lt;ApolloProvider /&gt;</code> - real graphql provider to allow testing some legacy code</li>
<li><code>&lt;MockedProvider /&gt;</code> - mocked graphql provider for testing with... mocks</li>
</ul>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> <span class="token function-variable function">NetworkProvider</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>client<span class="token punctuation">,</span> isMocked<span class="token punctuation">,</span> mocks<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isMocked<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MockedProvider</span></span> <span class="token attr-name">mocks</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>mocks<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
    
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ApolloProvider</span></span> <span class="token attr-name">client</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>client<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
<span class="token punctuation">}</span></code></pre>
<p>Note the different returned providers accept different props. <code>MockedProvider</code> accepts <code>mocks</code> prop, while the <code>ApolloProvider</code> does not, instead it accepts an optional <code>client</code> prop. That's an excellen opportunity to mix up the props and pass something that makes no sense. In the old days I used to use a check in the component to warn user incorrect props were passed, something like this:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>props<span class="token punctuation">.</span>isMocked <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token operator">!</span>props<span class="token punctuation">.</span>mocks<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Please only pass mocks if isMocked is true. '</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>isMocked <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token operator">!</span>props<span class="token punctuation">.</span>client<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Please only pass client if isMocked is false. '</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<p>Today, typescript can warn us if we pass incorrect props based on another prop, removing any need to do such checks. We just need to create 2 interfaces, one for each group of props, both having at least 1 common prop to help TS identify which of the 2 interfaces should be applied.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">{</span>MockedRequest<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"msw"</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">MockedProviderProps</span> <span class="token punctuation">{</span>
    isMocked<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// the common prop</span>
    mocks<span class="token operator">:</span> MockedRequest<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">ApolloProviderProps</span> <span class="token punctuation">{</span>
    isMocked<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// the common prop</span>
    client<span class="token operator">:</span> ApolloClient<span class="token operator">&lt;</span><span class="token builtin">unknown</span><span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">Props</span> <span class="token operator">=</span> MockedProviderProps

<span class="token keyword">const</span> <span class="token function-variable function">NetworkProvider</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>client<span class="token punctuation">,</span> isMocked<span class="token punctuation">,</span> mocks<span class="token punctuation">}</span><span class="token operator">:</span> Props<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isMocked<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MockedProvider</span></span> <span class="token attr-name">mocks</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>mocks<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>

    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ApolloProvider</span></span> <span class="token attr-name">client</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>client<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
<span class="token punctuation">}</span></code></pre>
<p>Now if we try to do something stupid - like pass the <code>mocks</code> prop while <code>isMocked === false</code>, typescript will warn us.</p>
<p>Just to give another, even more contrived example, let's use an imaginary component <code>Person</code>. The Persons live in a really horrible world where you can only choose 2 jobs, and if you don't have a hobby as an adult, everybody thinks you love nothing. It bodes well to our test case though.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">interface</span> <span class="token class-name">AdultProps</span> <span class="token punctuation">{</span>
  <span class="token comment">// Usually examples use "type: 'adult' | 'child'" as common property.</span>
  <span class="token comment">// Let's use a boolean just for fun, to make it clear it can work.</span>
  type<span class="token operator">:</span> <span class="token string">'adult'</span><span class="token punctuation">;</span> <span class="token comment">// "isAdult" is a common property between an adult and a Child</span>
  employer<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// An adult must have an employeer</span>
  jobTitle<span class="token operator">:</span> <span class="token string">"king"</span> <span class="token operator">|</span> <span class="token string">"engineer"</span><span class="token punctuation">;</span> <span class="token comment">// and work in one of our rather limited fields.</span>
  hobby<span class="token operator">?</span><span class="token operator">:</span> <span class="token string">"computers"</span> <span class="token operator">|</span> <span class="token string">"fishing"</span><span class="token punctuation">;</span> <span class="token comment">// An adult can have hobby, but it's not required.</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">ChildProps</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">'child'</span><span class="token punctuation">;</span> <span class="token comment">// The common property allows Typescript to discriminate the types.</span>
  hobby<span class="token operator">:</span> <span class="token string">"computers"</span> <span class="token operator">|</span> <span class="token string">"mudcakes"</span><span class="token punctuation">;</span> <span class="token comment">// A child must have a hobby, note it can overlap with adult hobbies.</span>
  school<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// A child must have school.</span>
  <span class="token comment">// It must not have employer or jobTitle (from the adult interface).</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">CommonProps</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// Both a child and an adult have names.</span>
<span class="token punctuation">}</span>

<span class="token comment">// Props is a combo of Common props and either adult or child props.</span>
<span class="token keyword">type</span> <span class="token class-name">Props</span> <span class="token operator">=</span> CommonProps <span class="token operator">&amp;</span> <span class="token punctuation">(</span>AdultProps <span class="token operator">|</span> ChildProps<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Person</span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token operator">:</span> Props<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'adult'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// We can't just destructure the props when declaring the function.</span>
    <span class="token comment">// Typescript won't be sure they'll be available yet.</span>
    <span class="token comment">// It will be though after we check the common prop and determine type.  </span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> employer<span class="token punctuation">,</span> jobTitle<span class="token punctuation">,</span> hobby <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, a(n) </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>jobTitle<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> employed by </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>employer<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. Loves 
        </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hobby <span class="token operator">??</span> <span class="token string">"nothing"</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> school<span class="token punctuation">,</span> hobby <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, a kid studying at </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>school<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. Loves </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hobby<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Now typescript will warn us if we mess up</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span></span>
        <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Arthur<span class="token punctuation">"</span></span>
        <span class="token attr-name">isAdult</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span></span>
        <span class="token attr-name">employer</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Townsfolk<span class="token punctuation">"</span></span>
        <span class="token attr-name">jobTitle</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>king<span class="token punctuation">"</span></span>
      <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span></span>
        <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>John<span class="token punctuation">"</span></span>
        <span class="token attr-name">isAdult</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span></span>
        <span class="token attr-name">hobby</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fishing<span class="token punctuation">"</span></span> <span class="token comment">// Typescript will warn us that only adults can fish. In it's own words...</span>
        <span class="token attr-name">school</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Vilnius 1st middle school<span class="token punctuation">"</span></span>
      <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Try it out in this codesandbox. Try adding <code>school=&quot;xyz&quot;</code> prop to the <code>Person</code> with <code>isAdult={true}</code> prop. Note how typescript warns you that this Person can not have such a prop.</p>
<iframe src="https://codesandbox.io/embed/typescript-discriminated-union-props-k1786b?fontsize=14&hidenavigation=1&theme=dark&view=editor"
style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;"
title="typescript-discriminated-union-props"
allow="accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking"
sandbox="allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts"
></iframe>
<p>Further reading:</p>
<ul>
<li><a href="https://www.typescriptlang.org/docs/handbook/2/narrowing.html#discriminated-unions">Discriminated unions - this is what I was talking about</a></li>
<li><a href="https://www.developerway.com/posts/advanced-typescript-for-react-developers-discriminated-unions">Another example</a></li>
</ul>
<p>Have a great day, reader. End.</p>
</div>
			</main>
			<footer class="footer">
				<div class="about">
					<div><strong>Kasparas Anusauskas</strong></div>
					<a href="https://www.linkedin.com/in/kasparas-anusauskas">LinkedIn</a>
				</div>
			</footer>
		</div>
		<!-- <div class="cookieBanner hidden"><div>Please note I'm using Google Analytics. This means this website is using all of the evil cookies you hear about. Only continue browsing if you're OK with that.</div> <button>I understand</button></div> -->
	</body>
</html>
